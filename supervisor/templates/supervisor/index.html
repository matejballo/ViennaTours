{% extends "nav.html" %}
{% block content %}

<div class="card-group">
    <div class="card bg-light">
        <div class="card-body text-center" id="balance">
            <p class="card-subtitle">- PEOPLE -</p>
            <div>
                <canvas id="earnings-chart"></canvas>
            </div>
       </div>
    </div>
    <div class="card bg-light">
        <div class="card-body text-center" id="driver-of-the-day">
            <img class="card-img" alt="trophy" src="../static/images/trophy-icon.svg" />
            <p class="card-subtitle">- BEST EMPLOYEE -</p>
            <h1 class="card-header-tabs">{{ best_driver.get_short_name }}</h1>
        </div>
    </div>
    <div class="card bg-light">
        <div class="card-body text-center" id="total">
            <p class="card-subtitle">- TOTAL -</p>
            <div>
                <canvas id="types-tours-chart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="table-header">
    <h2>Last tours</h2>
</div>

<table class="table">
    <thead>
        <tr>
            <th scope="col">Row</th>
            <th scope="col">Tour ID</th>
            <th scope="col">Car ID</th>
            <th scope="col">Date</th>
            <th scope="col">Driver</th>
            <th scope="col">Type</th>
            <th scope="col">Price</th>
            <th scope="col">People</th>
        </tr>
    </thead>
    <tbody>
        {% for post in last_tours %}
        <tr>
            <td>{{forloop.counter}}</td>
            <th scope="row">{{ post.id }}</th>
            <td>{{ post.carID.id }}</td>
            <td>{{ post.date|date:"d.m - H:i" }}</td>
            <td>{{ post.driverID.name }} {{ post.driverID.surname }}</td>
            <td>{{ post.tourType }}</td>
            <td>{{ post.price }}</td>
            <td>{{ post.people }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
    var jsonObject = JSON.parse('{{ tourdata | escapejs }}');
    console.log(jsonObject);

    var configTourTypes = {
        type: 'bar',
        data: {
            datasets: [{
                data: {{ tourdata| safe }},
                backgroundColor: ['#c0c0c0', '#daa520', '#b9f2ff'],
                label: 'Tours'}],
            labels: {{ tourlabels | safe }}
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                xAxes: [{
                gridLines: {
                color: "rgba(0, 0, 0, 0)",
                },
            }],
            yAxes: [{
                gridLines: {
                color: "rgba(0, 0, 0, 0)",
            },
            ticks: {
                autoSkip: true,
                maxTicksLimit: 6,
                max: 500
            }  
            }]
        }
        }   
    };

    var configTotalEarnings = {
        type: 'line',
        data: {
            datasets: [{
                data: {{ tourprices| safe }} 
            }],
            labels: {{ tourdates | safe }}
        },
        options: {
            legend: {
                display: false
            },
            layout: {
                padding: {
                    right: 10
                }
            },
            responsive: true,
            maintainAspectRatio: false,
            scales: {
            xAxes: [{
                ticks: {
                    display: false //this will remove only the label
                },
                gridLines: {
                color: "rgba(0, 0, 0, 0)",
            }
            }],
            yAxes: [{
            gridLines: {
                color: "rgba(0, 0, 0, 0)",
            },
            ticks: {
                max: 9
            }   
            }]
        }
        }   
    };

    function update_users_count() {
        var countValue = JSON.parse('{{ stats | escapejs }}');
        $('#value b').animate({
            counter: countValue.today
        }, {
                duration: 1000,
                easing: 'swing',
                step: function(now) {
                    $(this).text(Math.ceil(now));
                },
                complete: update_users_count
            });
    };

    update_users_count();

    window.onload = function () {
        var ctx = document.getElementById('types-tours-chart').getContext('2d');
        window.myPie = new Chart(ctx, configTourTypes);
        var ctx2 = document.getElementById('earnings-chart').getContext('2d');
        window.myPie = new Chart(ctx2, configTotalEarnings);
    };

    //var countValue = JSON.parse('{{ stats | escapejs }}');
    //const obj = document.getElementById("value");
    //animateValue(obj, countValue.today, 0, 5000);

</script>
{% endblock javascript %}


{% endblock content %}