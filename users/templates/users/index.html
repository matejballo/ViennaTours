{% extends "nav-user.html" %}
{% block content %}

<!-- Welcome message -->
<div class="table-header">
    <h4 id="welcome-message">Welcome {{ user.get_short_name }}</h4>
</div>

<!-- Charts -->
<div class="card-group">
    <div class="card bg-light">
        <div class="card-body text-center" id="balance">
            <p class="card-subtitle">- TYPES -</p>
            <div>
                <canvas id="types-tours-chart"></canvas>
            </div>
       </div>
    </div>
    <div class="card bg-light">
        <div class="card-body text-center" id="driver-of-the-day">
            <img class="card-img" alt="trophy" src="../static/images/stats-icon.svg" />
            <p class="card-subtitle">- TODAY -</p>
            <h1 class="card-header-tabs" id="totalcounter" >0 €</h1>
        </div>
    </div>
    <div class="card bg-light">
        <div class="card-body text-center" id="total">
            <p class="card-subtitle">- TOTAL -</p>
            <div>
            <canvas id="earnings-chart"></canvas>
            </div>
        </div>
     
    </div>
</div>

<!-- Last tours -->
<div class="table-header">
    <h4>Your last tours</h4>
</div>

<div class="table-responsive">
<table class="table p-4">
    <thead>
        <tr>
            <th scope="col">Tour Nr.</th>
            <th scope="col">Date</th>
            <th scope="col">Car Nr.</th>
            <th scope="col">Type</th>
            <th scope="col">People</th>
            <th scope="col">Price</th>
        </tr>
    </thead>
    <tbody>
        {% for tour in tours %}
        <tr>
            <th scope="row">{{ tour.id }}</th>
            <td>{{ tour.date|date:"d.m - H:i" }}</td>
            <td>{{ tour.carID.plate }}</td>
            <td>{{ tour.tourType }}</td>
            <td>{{ tour.people }}x</td>
            <td>{{ tour.price }} €</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
    //Configuration for chart of tour types
    var configTourTypes = {
        type: 'pie',
        data: {
            datasets: [{
                data: {{ tourdata| safe }},
                backgroundColor: ['#c0c0c0', '#daa520', '#b9f2ff'],
                label: 'Tours'}],
            labels: {{ tourlabels | safe }}
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,  
        }   
    };

    //Configuration for chart of tours by date
    var configTotalEarnings = {
        type: 'line',
        data: {
            datasets: [{
                data: {{ tourprices| safe }} 
            }],
            labels: {{ tourdates | safe }}
        },
        options: {
            legend: {
                display: false
            },  
            responsive: true,
            maintainAspectRatio: false,
            scales: {
            xAxes: [{
                ticks: {
                    display: false //this will remove only the label
                },
                gridLines: {
                color: "rgba(0, 0, 0, 0)",
            }
            }],
            yAxes: [{
            gridLines: {
                color: "rgba(0, 0, 0, 0)",
            }   
            }]
        }
        }   
    };

    //Count to specific value of today earnings
    var jsonObject = JSON.parse('{{ stats | escapejs }}');
    console.log(jsonObject.today);
    var j = 0;
    var animationSpeed = 10;
    var maxLimit = jsonObject.today;
    function countValue() {
        if(j <= maxLimit) {
            document.getElementById("totalcounter").innerHTML = (parseInt(j) + " €");
        }
        j++;
        setTimeout(countValue, animationSpeed);
    }

    //Apear welcome message
    var step = 0.05;
    var currentOpacity = 0.05;
    var maxOpacity = 1.0;
    function appearWelcomeMessage() {
        if(currentOpacity <= maxLimit) {
            document.getElementById("welcome-message").style.opacity = currentOpacity.toString();
        }
        currentOpacity += step;
        setTimeout(appearWelcomeMessage, 50);
    }

    //On load window display charts and welcome message
    window.onload = function () {
        var ctx = document.getElementById('types-tours-chart').getContext('2d');
        window.myPie = new Chart(ctx, configTourTypes);
        var ctx2 = document.getElementById('earnings-chart').getContext('2d');
        window.myPie = new Chart(ctx2, configTotalEarnings);
        countValue();
        appearWelcomeMessage();
    };
</script>
{% endblock javascript %}

{% endblock content %}